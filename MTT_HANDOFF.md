# MTT 实验助手 - 工作交接说明

本说明用于接续开发当前的“手机可用”MTT 实验小程序（PWA 网页版）。阅读本文件即可继续修改。

## 当前交付物与路径
- 移动端网页版本目录：`E:\MTT\mtt-web`
  - `index.html` 页面结构 + 文案
  - `styles.css` 样式（移动优先、PWA 视觉）
  - `app.js` 核心计算逻辑
  - `manifest.json` + `sw.js` + `icon.svg` （PWA 支持）
- 旧的桌面版 Tkinter（保留）：`E:\MTT\mtt_assistant.py`

## 如何运行/验证（手机）
- 最简单：把 `E:\MTT\mtt-web` 拷到手机，用浏览器直接打开 `index.html`
- 若要“添加到主屏幕/离线”：PC 端进入 `E:\MTT\mtt-web` 后运行 `python -m http.server`，手机访问 `http://电脑IP:8000`

## 功能现状（按 Tab）
### Tab 1 - 细胞计数与铺板
位置：`E:\MTT\mtt-web\app.js`
计算公式：
- 原液细胞密度 = (计数总数 / 计数大格数) × 10000 × 稀释倍数
- 铺板目标密度 = 目标每孔细胞数 / 每孔体积
- 总体积 = 使用孔数 × 每孔体积 × 板数 + 余量
输出：原液密度、目标密度、总细胞数、配制体积、取原液体积与加培养基体积。

### Tab 2 - 单药梯度（已改为连续稀释）
位置：`E:\MTT\mtt-web\app.js`
算法逻辑（Serial Dilution）：
- 输入：母液浓度（mM）、计划每管体积（μL）、最小母液取样体积（μL）、目标终浓度列表（μM）
- 目标浓度自动从高到低排序；方式B（2X）会把目标终浓度 ×2 作为“配液浓度”
- 最高浓度管：从母液配制
- 其后每管：从上一管取样 + 加培养基（连续稀释）
- 若最高浓度管母液取样 < 最小阈值（默认 2 μL），自动放大“每管总体积”并提示
- 若中间梯度取样偏小（< 最小阈值），仅提示，不自动放大（可后续扩展）
显示表头：
- 终浓度（μM）
- 配液浓度（μM）
- 来源（母液 / 上一管）
- 取样体积（μL）
- 加培养基（μL）

已知限制（可后续改进）：
- 只对第一管（母液取样）强制扩容；中间梯度如果取样过小只提示
- 未自动判定“梯度是否等比/等差”，仅按输入执行连续稀释

### Tab 3 - 双药混配（A × B 矩阵）
位置：`E:\MTT\mtt-web\app.js`
当前实现：
- 输入：药A母液浓度（mM）、药B母液浓度（mM）、每管配制体积（μL）
- 输入：药A终浓度序列（μM）、药B终浓度序列（μM）
- 自动生成 A × B 的矩阵组合并计算体积
- 方式B（2X）自动把目标终浓度 ×2 作为配液浓度
输出：每个组合的 A/B 取样体积与补培养基体积。

已知限制：
- 未输出 96 孔板布局矩阵（仅列表）
- 未进行双药“连续稀释/梯度传递”逻辑（目前均为直接从母液配制）

## 需要继续做/可选增强
1) 双药矩阵输出为 96 孔板布局（含复孔、空白孔、对照孔设置）
2) 单药连续稀释：对每一步取样体积也做最小体积约束并自动扩容
3) 导出 CSV/Excel（浓度与配液表格）
4) 添加“等比/等差”自动生成梯度

## 关键改动记录
### 单药梯度
已将“每管独立由母液配制”改为“连续稀释 + 自动排序 + 母液取样过小自动扩容”。

### 双药梯度
已将“逐行输入组合”改为“输入 A/B 浓度序列生成矩阵组合”，单位改为 μM。

